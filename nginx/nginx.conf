server {
    # Nginx posluša na vratih 80
    listen 80;

    # Korenska mapa znotraj Docker zabojnika
    root /var/www;

    # Določimo privzete datoteke ob vstopu
    index index.php index.html index.htm;

    # Glavni blok za obravnavo zahtev, ki niso za PHP
    location / {
        # Poskusi streči datoteko (npr. /css/style.css), 
        # nato poskusi streči mapo (npr. /admin/)
        # in na koncu posreduj zahtevo na index.php (za front-controller pattern)
        try_files $uri $uri/ /index.php?$query_string;
    }

    # Blok za obravnavo vseh .php datotek
    location ~ \.php$ {
        # Preveri, ali datoteka obstaja, sicer vrni 404
        try_files $uri =404;

        # KLJUČNO: Posreduj zahtevo na PHP-FPM servis na vratih 9000
        # "php-fpm" mora biti enako imenu vašega servisa v docker-compose.yml
        fastcgi_pass php-fpm:9000;
        
        fastcgi_index index.php;
        include fastcgi_params;
        
        # Ključni parametri za PHP-FPM
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param PATH_INFO $fastcgi_path_info;
    }

    # Prepreči dostop do skritih datotek (.ht, .git itd.)
    location ~ /\. {
        deny all;
    }
}
